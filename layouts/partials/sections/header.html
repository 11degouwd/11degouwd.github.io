<script>
let localStorageValue = localStorage.getItem("pref-theme");
let defaultTheme = "{{ .Site.Params.theme.defaultTheme }}"; // light, dark, auto
let mediaQuery = window.matchMedia('(prefers-color-scheme: dark)').matches;

// Only apply defaultTheme if there is no user preference
if (!localStorageValue) {
    switch(defaultTheme) {
        case "light":
            if (document.body.className.includes("dark")) {
                document.body.classList.remove('dark');
                document.documentElement.classList.remove('dark');
                localStorage.setItem("pref-theme", 'light');
            }
            break;
        case "dark":
            if (document.body.className.includes("light")) {
                document.body.classList.add('dark');
                document.documentElement.classList.add('dark');
                localStorage.setItem("pref-theme", 'dark');
            }
            break;
        default: // auto
            if (mediaQuery) {
                document.body.classList.add('dark');
                document.documentElement.classList.add('dark');
            } else {
                if (document.body.className.includes("dark")) {
                    document.body.classList.remove('dark');
                    document.documentElement.classList.remove('dark');
                    localStorage.setItem("pref-theme", 'light');
                }
            }
            break;
    }
} else {
    if (localStorageValue === "dark") {
        if (document.body.className.includes("light")) {
            document.documentElement.classList.add('dark');
            document.body.classList.add('dark');
        }
    } else if (localStorageValue === "light") {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            document.documentElement.classList.remove('dark');
        }
    }
}
</script>

<!-- Show header on scroll up -->
{{ if .Site.Params.navbar.stickyNavBar.enable | default false }}
{{ $showNavBarOnScrollUp := .Site.Params.navbar.stickyNavBar.showOnScrollUp | default false }}
<script>
    var prevScrollPos = window.pageYOffset;
    window.addEventListener("scroll", function showHeaderOnScroll() {
        let profileHeaderElem = document.getElementById("profileHeader");
        let currentScrollPos = window.pageYOffset;
        let resetHeaderStyle = false;
        let showNavBarOnScrollUp = {{ $showNavBarOnScrollUp }};
        let showNavBar = showNavBarOnScrollUp ? prevScrollPos > currentScrollPos : currentScrollPos > 0;
        if (showNavBar) {
            profileHeaderElem.classList.add("showHeaderOnTop");
        } else {
            resetHeaderStyle = true;
        }
        if(currentScrollPos === 0) {
            resetHeaderStyle = true;
        }
        if(resetHeaderStyle) {
            profileHeaderElem.classList.remove("showHeaderOnTop");
        }
        prevScrollPos = currentScrollPos;
    });
</script>
{{ end }}

<!-- Navbar -->
<header id="profileHeader">
    <nav class="pt-3 navbar navbar-expand-lg {{ if .Site.Params.animate }}animate{{ end }}">
        <div class="container-fluid mx-xs-2 mx-sm-5 mx-md-5 mx-lg-5">
            <!-- navbar brand -->
            <a class="navbar-brand primary-font text-wrap" href="{{ .Site.BaseURL | relURL }}">
                {{ if and (or (.Site.Params.favicon) (.Site.Params.navbar.brandLogo)) (.Site.Params.navbar.showBrandLogo | default true) }}
                <img src="{{ .Site.Params.navbar.brandLogo | default .Site.Params.favicon }}" width="30" height="30"
                    class="d-inline-block align-top">
                {{ .Site.Params.navbar.brandName | default .Site.Params.title }}
                {{ else }}
                {{ .Site.Params.navbar.brandName | default .Site.Params.title }}
                {{ end }}
            </a>

            <!-- navbar toggler - For small screens -->
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent"
                aria-controls="navbarContent" aria-expanded="false" aria-label="Toggle navigation">
                <svg aria-hidden="true" height="24" viewBox="0 0 16 16" version="1.1" width="24" data-view-component="true">
                    <path fill-rule="evenodd" d="M1 2.75A.75.75 0 011.75 2h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 2.75zm0 5A.75.75 0 011.75 7h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 7.75zM1.75 12a.75.75 0 100 1.5h12.5a.75.75 0 100-1.5H1.75z"></path>
                </svg>
            </button>

            <!-- navbar content -->
            <div class="collapse navbar-collapse text-wrap primary-font" id="navbarContent">
                <ul class="navbar-nav {{ .Site.Params.navbar.align | default "ms-auto"}} text-center">

                    {{ if and (.Site.Params.about.enable | default false) (not (.Site.Params.navbar.menus.disableAbout | default false)) }}
                    <li class="nav-item navbar-text">
                        <a class="nav-link" href="{{ .Site.BaseURL | relURL }}#about" aria-label="about" data-section="about">
                            {{ .Site.Params.about.title | default "About" }}
                        </a>
                    </li>
                    {{ end }}
                    
                    {{ if and (.Site.Params.experience.enable | default false) (not (.Site.Params.navbar.menus.disableExperience | default false)) }}
                      {{ $companies := site.GetPage "section" "companies" }}
                      <li class="nav-item dropdown navbar-text">
                        <a
                          class="nav-link dropdown-toggle"
                          href="{{ .Site.BaseURL | relURL }}#experience"
                          id="experienceDropdown"
                          role="button"
                          aria-expanded="false"
                          data-section="experience"
                        >
                          {{ .Site.Params.experience.title | default "Experience" }}
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="experienceDropdown">
                          {{ range $companies.Sections.ByTitle }}
                            {{ $companySlug := path.Base .File.Dir }}
                            <li><a class="dropdown-item" href="{{ .RelPermalink }}" data-company="{{ $companySlug | lower }}">{{ .Title }}</a></li>
                          {{ end }}
                        </ul>
                      </li>
                    {{ end }}

                    {{ if and (.Site.Params.education.enable | default false) (not (.Site.Params.navbar.menus.disableEducation | default false)) }}
                    <li class="nav-item navbar-text">
                        <a class="nav-link" href="{{ .Site.BaseURL | relURL }}#education"
                            aria-label="education" data-section="education">
                            {{ .Site.Params.education.title | default "Education" }}
                        </a>
                    </li>
                    {{ end }}

                    {{ if and (.Site.Params.techstack.enable | default false) (not (.Site.Params.navbar.menus.disableTechstack | default false)) }}
                    <li class="nav-item navbar-text">
                        <a class="nav-link" href="{{ .Site.BaseURL | relURL }}#techstack"
                            aria-label="techstack" data-section="techstack">
                            {{ .Site.Params.techstack.title | default "Tech Stack" }}
                        </a>
                    </li>
                    {{ end }}

                    {{ if and (.Site.Params.projects.enable | default false) (not (.Site.Params.navbar.menus.disableProjects | default false)) }}
                    <li class="nav-item navbar-text">
                        <a class="nav-link" href="{{ .Site.BaseURL | relURL }}#projects"
                            aria-label="projects" data-section="projects">
                            {{ .Site.Params.projects.title | default "Projects" }}
                        </a>
                    </li>
                    {{ end }}

                    {{ if and (.Site.Params.achievements.enable | default false) (not (.Site.Params.navbar.menus.disableAchievements | default false)) }}
                    <li class="nav-item navbar-text">
                        <a class="nav-link" href="{{ .Site.BaseURL | relURL }}#achievements"
                            aria-label="achievements" data-section="achievements">
                            {{ .Site.Params.achievements.title | default "Achievements" }}
                        </a>
                    </li>
                    {{ end }}
                    
                    {{ if .Site.Params.navbar.showContactLast }}
                      <!-- custom menus from the user -->
                      {{ range .Site.Menus.main }}
                        {{ if .HasChildren }}
                          <!-- Dropdown menu -->
                          <li class="nav-item navbar-text dropdown">
                              <a class="nav-link dropdown-toggle" href="{{ .URL }}" id="navbarDropdown" role="button"
                                  data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false" title="{{ .Title }}"
                                  data-section="{{ .Identifier }}">
                                  {{ .Name }}
                              </a>
                              <div class="dropdown-menu shadow-lg rounded" aria-labelledby="navbarDropdown">
                                  {{ range .Children }}
                                  <a class="dropdown-item nav-link" href="{{ .URL }}"
                                      title="{{ .Title }}"
                                      data-section="{{ .Parent }}">
                                      {{ .Name }}
                                  </a>
                                  {{ end }}
                              </div>
                          </li>
                        {{else}}
                          <!-- Single menu item -->
                          <li class="nav-item navbar-text">
                              <a class="nav-link" href="{{.URL}}" title="{{ .Title }}">
                                  {{ .Pre }}
                                  {{ .Name }}
                              </a>
                          </li>
                        {{end}}
                      {{end}}
                    {{end}}

                    {{ if and (.Site.Params.contact.enable | default false) (not (.Site.Params.navbar.menus.disableContact | default false)) }}
                    <li class="nav-item navbar-text">
                        <a class="nav-link" href="{{ .Site.BaseURL | relURL }}#contact"
                            aria-label="contact" data-section="contact">
                            {{ .Site.Params.contact.title | default "Contact" }}
                        </a>
                    </li>
                    {{ end }}
                    
                    {{ if not .Site.Params.navbar.showContactLast }}
                      <!-- Nav Bar Separator  -->
                      {{ if and .Site.Menus.main (.Site.Params.navbar.enableSeparator | default false) }}
                          <li class="nav-item navbar-text d-none d-lg-block d-xl-block"><div class="nav-link nav-link-sep"></div></li>
                          <div class="dropdown-divider"></div>
                      {{ end }}

                      <!-- custom menus from the user -->
                      {{ range .Site.Menus.main }}
                        {{ if .HasChildren }}
                          <!-- Dropdown menu -->
                          <li class="nav-item navbar-text dropdown">
                              <a class="nav-link dropdown-toggle" href="{{ .URL }}" id="navbarDropdown" role="button"
                                  data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false" title="{{ .Title }}"
                                  data-section="{{ .Identifier }}">
                                  {{ .Name }}
                              </a>
                              <div class="dropdown-menu shadow-lg rounded" aria-labelledby="navbarDropdown">
                                  {{ range .Children }}
                                  <a class="dropdown-item nav-link" href="{{ .URL }}"
                                      title="{{ .Title }}"
                                      data-section="{{ .Parent }}">
                                      {{ .Name }}
                                  </a>
                                  {{ end }}
                              </div>
                          </li>
                        {{else}}
                          <!-- Single menu item -->
                          <li class="nav-item navbar-text">
                              <a class="nav-link" href="{{.URL}}" title="{{ .Title }}">
                                  {{ .Pre }}
                                  {{ .Name }}
                              </a>
                          </li>
                        {{end}}
                      {{end}}
                    {{end}}

                    {{ if not (.Site.Params.navbar.disableSearch | default false) }}
                      <li class="nav-item d-none d-md-flex align-items-center navbar-search-item position-relative">
                          <button type="button"
                                  id="search-toggle"
                                  class="btn nav-link p-0"
                                  aria-label="Search"
                                  onclick="toggleSearch()">
                              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                  <circle cx="11" cy="11" r="8"></circle>
                                  <path d="m21 21-4.35-4.35"></path>
                              </svg>
                          </button>

                          <input id="navbar-search"
                                autocomplete="off"
                                class="form-control ms-2"
                                data-show-descriptions="{{ .Site.Params.search.showDescriptions | default true }}"
                                placeholder='{{ .Site.Params.navbar.searchPlaceholder | default "Search..." }}'
                                aria-label="Search"
                                oninput="searchOnChange(event)">
                      </li>
                    {{ end }}

                    {{ if (not .Site.Params.theme.disableThemeToggle | default false) }}
                      <li class="nav-item d-none d-md-flex align-items-center">
                        <button id="theme-toggle"
                                class="btn nav-link theme-toggle p-0"
                                aria-label="Toggle theme">
                          <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                  viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                  stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                  <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                              </svg>
                              <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                  viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                  stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                  <circle cx="12" cy="12" r="5"></circle>
                                  <line x1="12" y1="1" x2="12" y2="3"></line>
                                  <line x1="12" y1="21" x2="12" y2="23"></line>
                                  <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                                  <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                                  <line x1="1" y1="12" x2="3" y2="12"></line>
                                  <line x1="21" y1="12" x2="23" y2="12"></line>
                                  <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                                  <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                              </svg>
                        </button>
                      </li>
                      <li class="nav-item d-md-none navbar-text">
                        <div class="text-center">
                            <button id="theme-toggle" class="theme-toggle">
                                <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                                </svg>
                                <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="12" cy="12" r="5"></circle>
                                    <line x1="12" y1="1" x2="12" y2="3"></line>
                                    <line x1="12" y1="21" x2="12" y2="23"></line>
                                    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                                    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                                    <line x1="1" y1="12" x2="3" y2="12"></line>
                                    <line x1="21" y1="12" x2="23" y2="12"></line>
                                    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                                    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                                </svg>
                            </button>
                        </div>
                    </li>
                    {{ end }}

                </ul>

            </div>
        </div>
    </nav>
</header>

{{ if or (.Site.Params.singlePages.scrollprogress.enable | default true) (.Params.enableScrollProgress) }}
<div id="scroll-progress-container">
  <div id="scroll-progress-bar" class="progress-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100"></div>
</div>
<script src="{{.Site.Params.staticPath}}/js/scrollProgressBar.js"></script>
{{ end }}

<!-- Mobile navbar behavior (dropdowns, collapse prevention, click-outside) -->
<script src="{{.Site.Params.staticPath}}/js/navbarMobile.js"></script>

<script>
  function toggleSearch() {
  const input = document.getElementById("navbar-search");
  const searchContent = document.getElementById("search-content");
  const searchResultsContainer = document.getElementById("search-results");

  if (!input || !searchContent || !searchResultsContainer) return;

  if (input.style.display === "block") {
    input.style.display = "none";
    searchContent.style.display = "none";
    searchResultsContainer.innerHTML = "";
    return;
  } else {
    input.style.display = "block";
    input.focus();

    // Shows results box if text is present
    requestAnimationFrame(() => {
      positionSearchContent();
    });

    // Runs the search again if text is present
    if (input.value.trim() !== "") {
      performSearch({ target: input }); // refresh results
    }
  }
}


  document.addEventListener("keydown", function (e) {
    if ((e.ctrlKey || e.metaKey) && e.key === "k") {
        e.preventDefault();
        const input = document.getElementById("navbar-search");
        input.classList.add("active");
        input.focus();
    }
  });
</script>