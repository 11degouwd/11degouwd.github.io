{{ if .Site.Params.experience.enable | default false }}

<link rel="stylesheet" href="{{ "css/experience.css" | relURL }}">

<section id="experience" class="py-5">
  <div class="container">
    <h3 class="text-center">
      {{ .Site.Params.experience.title | default "Experience" }} 
    </h3>

    <div class="row justify-content-center">
      <div class="col-sm-12 col-md-8 col-lg-8 py-5">
        <div class="experience-container px-3 pt-2">

          <!-- Sort roles by most recent first start and currently active -->
          {{ $roles := where site.RegularPages "Section" "experience" }}
          {{ $current := where $roles ".Params.end" "==" nil }}
          {{ $current = sort $current "Params.start" "desc" }}
          {{ $past := where $roles ".Params.end" "!=" nil }}
          {{ $past = sort $past "Params.end" "desc" }}
          {{ $roles = union $current $past }}
          {{ $groups := $roles.GroupByParam "company_slug" }} 
 
          {{ if gt (len $groups) 0 }}
          <div class="experience-container-loop">

            {{ range $groups }} <!-- .Key is the company slug --> 
              {{ $group := . }}
              {{ $companyPath := path.Join "companies" $group.Key }}
              {{ $company := site.GetPage "section" $companyPath }}

              <div class="experience-company">
                {{ if $company }}
                  <div class="company-header">

                    {{ $logoPath := path.Join "images" $group.Key $company.Params.logo }}

                    {{ if and $company.Params.logo (fileExists (printf "static/%s" $logoPath)) }}
                      <a class="company-logo-link" href="{{ $company.RelPermalink }}">
                        <img src="{{ $logoPath | relURL }}" class="company-logo">
                      </a>
                    {{ else }}
                      <a class="company-logo-link" href="{{ $company.RelPermalink }}">
                        <img  src="https://ui-avatars.com/api/?name={{ $company.Title | humanize | urlquery }}&size=150&bold=true&background=DDDDDD&color=555555" 
                            alt="Missing company" 
                            class="company-logo">
                      </a>
                      {{ warnf "Missing logo for company: %s (expected at: %s)" $company.Title $logoPath }}
                    {{ end }}
                    <div>
                      <h4 class="company-title">
                        <a href="{{ $company.RelPermalink }}">{{ $company.Title }}</a>
                      </h4>
                      <div class="company-dates">{{ $company.Params.start }} – {{ $company.Params.end | default "Present" }}</div>
                    </div>
                  </div>
                {{ else }}
                  <div class="company-header">
                    <a href="#" class="company-logo-link">
                      <img  src="https://ui-avatars.com/api/?name={{ $group.Key | humanize | urlquery }}&size=150&bold=true&background=DDDDDD&color=555555" 
                            alt="Missing company" 
                            class="company-logo">
                    </a>
                    <div>
                      <h4 class="company-title">{{ $group.Key | humanize }}</h4>
                    </div>
                  </div>
                  {{ warnf "Missing company page: %s" $companyPath }}
                {{ end }}

                  <div class="roles-list">
                    {{ range .Pages }}
                      <div class="role-row">
                        <div class="role-dot"></div>
                        <div class="role-body"> 
                          <div class="role-title">{{ .Title }}</div>
                          <div class="role-meta">
                            {{ .Params.start | time.Format "Jan 2006" }} –
                            {{ with .Params.end }}{{ . | time.Format "Jan 2006" }}{{ else }}Present{{ end }}
                            {{ with .Params.location }} · {{ . }}{{ end }}
                          </div>
                          <p class="role-summary">{{ .Params.summary }}</p>
                        </div>
                      </div>
                    {{ end }}
                  </div>
              </div>
            {{ end }}

          </div>
          {{ end }}

        </div>
      </div>
    </div>
  </div>
</section>
{{ end }}