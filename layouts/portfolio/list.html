{{ define "head" }}
<meta name="description" content="{{ .Params.description }}">
<link rel="stylesheet" href="{{.Site.Params.staticPath}}/css/list.css">

<!-- fontawesome -->
<script defer src="{{.Site.Params.staticPath}}/fontawesome-6/all-6.4.2.js"></script>
{{ end }}

{{ define "title" }}
{{.Title }} | {{ .Site.Title }}
{{ end }}

{{ define "main" }}

{{/* Collect unique tags */}}
{{ $allTags := slice }}
{{ range .RegularPages }}
  {{ range .Params.tags }}
    {{ $allTags = $allTags | append . }}
  {{ end }}
{{ end }}
{{ $allTags = $allTags | uniq | sort }}

<section id="portfolio">
  <h1 style="text-align:center; font-size:2rem; font-weight:bold; margin-bottom:1.5rem;">
    {{ .Title }}
  </h1>

  <!-- Filter buttons -->
  <div class="project-filters" style="text-align:center; margin-bottom:2.5rem;">
    <button class="filter-btn active" data-tag="All">All</button>
    {{ range $allTags }}
      <button class="filter-btn" data-tag="{{ . }}">{{ . }}</button>
    {{ end }}
  </div>

  {{ $projectsList := .RegularPages.ByDate.Reverse }}

  {{ partial "project-cards.html" (dict
    "projectsList" $projectsList
    "showCompanyName" true
  ) }}

</section>

<!-- Filtering logic -->
<script>
  const buttons = document.querySelectorAll('.filter-btn')
  const cards = document.querySelectorAll('.project-card')

  buttons.forEach(btn => {
    btn.addEventListener('click', () => {
      buttons.forEach(b => b.classList.remove('active'))
      btn.classList.add('active')

      const tag = btn.dataset.tag
      cards.forEach(card => {
        const tags = card.dataset.tags.split(' ')
        card.style.display =
          tag === 'All' || tags.includes(tag) ? 'flex' : 'none'
      })
    })
  })

  // Make project tags clickable to filter projects
  const tagButtons = document.querySelectorAll('.tag-btn');

  tagButtons.forEach(tagBtn => {
    tagBtn.addEventListener('click', (event) => {
      event.preventDefault();   // Prevent default button action
      event.stopPropagation();  // Stop the click from reaching the <a> parent

      const tag = tagBtn.dataset.tag;

      // Trigger the filter button
      const filterBtn = Array.from(buttons).find(b => b.dataset.tag === tag);
      if (filterBtn) {
        filterBtn.click();

        // Optional: scroll to top of grid after filtering
        document.querySelector('div[style*="grid-template-columns"]').scrollIntoView({ behavior: 'smooth' });
      }
    });
  });

  // Check URL for tag query param
  const urlParams = new URLSearchParams(window.location.search);
  const initialTag = urlParams.get("tag");
  if (initialTag) {
    const filterBtn = Array.from(buttons).find(b => b.dataset.tag === initialTag);
    if (filterBtn) filterBtn.click();
  }
</script>

{{ end }}
